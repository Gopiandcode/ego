<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (ego.Ego.Generic.Make)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">ego</a> &#x00BB; <a href="../../index.html">Ego</a> &#x00BB; <a href="../index.html">Generic</a> &#x00BB; Make</nav><h1>Module <code>Generic.Make</code></h1><p>This functor <a href="index.html"><code>Make</code></a> serves as the main interface to Ego's generic EGraphs, and constructs an EGraph given a <a href="../module-type-LANGUAGE/index.html"><code>LANGUAGE</code></a>, an <a href="../module-type-ANALYSIS/index.html"><code>ANALYSIS</code></a> and it's <a href="../module-type-ANALYSIS_OPS/index.html"><code>ANALYSIS_OPS</code></a>.</p></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-L/index.html">L</a> : <a href="../index.html#module-type-LANGUAGE">LANGUAGE</a></code></li><li><code><a href="argument-2-A/index.html">A</a> : <a href="../index.html#module-type-ANALYSIS">ANALYSIS</a></code></li><li><code><a href="argument-3-MakeAnalysisOps/index.html">MakeAnalysisOps</a> : <span class="keyword">functor</span> (<a href="argument-3-MakeAnalysisOps/argument-1-S/index.html">S</a> : <a href="../index.html#module-type-GRAPH_API">GRAPH_API</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>'p <a href="argument-3-MakeAnalysisOps/index.html#type-t">t</a></span> = <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <span class="type-var">'p</span>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="argument-3-MakeAnalysisOps/index.html#type-analysis">analysis</a> := <a href="argument-2-A/index.html#type-t">A.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="argument-3-MakeAnalysisOps/index.html#type-data">data</a> := <a href="argument-2-A/index.html#type-data">A.data</a> <span class="keyword">and</span> <span class="keyword">type</span> <span>'a <a href="argument-3-MakeAnalysisOps/index.html#type-shape">shape</a></span> := <span><span class="type-var">'a</span> <a href="argument-1-L/index.html#type-shape">L.shape</a></span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="argument-3-MakeAnalysisOps/index.html#type-node">node</a> := <a href="argument-1-L/index.html#type-t">L.t</a>) <span>&#45;&gt;</span> <a href="../index.html#module-type-ANALYSIS_OPS">ANALYSIS_OPS</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>'p <a href="argument-3-MakeAnalysisOps/index.html#type-t">t</a></span> = <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <span class="type-var">'p</span>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="argument-3-MakeAnalysisOps/index.html#type-analysis">analysis</a> := <a href="argument-2-A/index.html#type-t">A.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="argument-3-MakeAnalysisOps/index.html#type-data">data</a> := <a href="argument-2-A/index.html#type-data">A.data</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="argument-3-MakeAnalysisOps/index.html#type-node">node</a> := <span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span></code></li></ul><h3 class="heading">Signature</h3><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>'p t</span></code><code> = <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <span class="type-var">'p</span>)</span> <a href="../index.html#type-egraph">egraph</a></span></code></dt><dd><p>This type represents an EGraph parameterised over a particular language <a href="argument-1-L/index.html"><code>L</code></a> and analysis <a href="argument-2-A/index.html"><code>A</code></a>.</p></dd></dl><dl><dt class="spec module" id="module-Rule"><a href="#module-Rule" class="anchor"></a><code><span class="keyword">module</span> <a href="Rule/index.html">Rule</a> : <a href="../index.html#module-type-RULE">RULE</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-RULE/index.html#type-query">query</a> := <span><a href="argument-1-L/index.html#type-op">L.op</a> <a href="../Query/index.html#type-t">Query.t</a></span> <span class="keyword">and</span> <span class="keyword">type</span> <span>'a <a href="../module-type-RULE/index.html#type-egraph">egraph</a></span> := <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <span class="type-var">'a</span>)</span> <a href="../index.html#type-egraph">egraph</a></span></code></dt><dd><p>This module <a href="Rule/index.html"><code>Rule</code></a> defines the rewrite interface for the EGraph, allowing users to express relatively complex transformations of expressions of the Language <a href="argument-1-L/index.html"><code>L</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-freeze"><a href="#val-freeze" class="anchor"></a><code><span class="keyword">val</span> freeze : <span><a href="../index.html#type-rw">rw</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><a href="../index.html#type-ro">ro</a> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>freeze graph</code> returns a read-only reference to the EGraph.</p><p><b>Note</b>: it is safe to modify <code>graph</code> after passing it to freeze, this method is mainly intended to allow using the read-only APIs of the EGraph when you have a RW instance of the EGraph.</p></dd></dl><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <a href="argument-2-A/index.html#type-t">A.t</a> <span>&#45;&gt;</span> <span><span class="type-var">'p</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>init analysis</code> creates a new EGraph with an initial persistent analysis state of <code>analysis</code>.</p></dd></dl><dl><dt class="spec value" id="val-class_equal"><a href="#val-class_equal" class="anchor"></a><code><span class="keyword">val</span> class_equal : <span><a href="../index.html#type-ro">ro</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>class_equal graph cls1 cls2</code> returns true if and only if <code>cls1</code> and <code>cls2</code> are congruent in the EGraph <code>graph</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_data"><a href="#val-set_data" class="anchor"></a><code><span class="keyword">val</span> set_data : <span><a href="../index.html#type-rw">rw</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> <a href="argument-2-A/index.html#type-data">A.data</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_data graph cls data</code> sets the analysis data for EClass <code>cls</code> in EGraph <code>graph</code> to be <code>data</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_data"><a href="#val-get_data" class="anchor"></a><code><span class="keyword">val</span> get_data : <span><span class="type-var">_</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> <a href="argument-2-A/index.html#type-data">A.data</a></code></dt><dd><p><code>get_data graph cls</code> returns the analysis data for EClass <code>cls</code> in EGraph <code>graph</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_analysis"><a href="#val-get_analysis" class="anchor"></a><code><span class="keyword">val</span> get_analysis : <span><a href="../index.html#type-rw">rw</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="argument-2-A/index.html#type-t">A.t</a></code></dt><dd><p><code>get_analysis graph</code> returns the persistent analysis sate for an EGraph.</p></dd></dl><dl><dt class="spec value" id="val-iter_children"><a href="#val-iter_children" class="anchor"></a><code><span class="keyword">val</span> iter_children : <span><a href="../index.html#type-ro">ro</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> <span><span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span> Iter.t</span></code></dt><dd><p><code>iter_children graph cls</code> returns an iterator over the elements of an eclass <code>cls</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_dot"><a href="#val-to_dot" class="anchor"></a><code><span class="keyword">val</span> to_dot : <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <span class="type-var">_</span>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span>&#45;&gt;</span> Odot.graph</code></dt><dd><p><code>to_dot graph</code> converts an EGraph into a Graphviz representation for debugging.</p></dd></dl><dl><dt class="spec value" id="val-add_node"><a href="#val-add_node" class="anchor"></a><code><span class="keyword">val</span> add_node : <span><a href="../index.html#type-rw">rw</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="argument-1-L/index.html#type-t">L.t</a> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a></code></dt><dd><p><code>add_node graph term</code> adds the term <code>term</code> into the EGraph <code>graph</code> and returns the corresponding equivalence class.</p></dd></dl><dl><dt class="spec value" id="val-merge"><a href="#val-merge" class="anchor"></a><code><span class="keyword">val</span> merge : <span><a href="../index.html#type-rw">rw</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> <a href="../../Id/index.html#type-t">Id.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>merge graph cls1 cls2</code> merges the two equivalence classes <code>cls1</code> and <code>cls2</code>.</p></dd></dl><dl><dt class="spec value" id="val-rebuild"><a href="#val-rebuild" class="anchor"></a><code><span class="keyword">val</span> rebuild : <span><a href="../index.html#type-rw">rw</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>rebuild graph</code> restores the internal invariants of the graph.</p><p><b>Note</b>: If you call <a href="index.html#val-merge"><code>merge</code></a> manually (i.e outside of analysis functions), you must call <a href="index.html#val-rebuild"><code>rebuild</code></a> before running any queries or extraction.</p></dd></dl><dl><dt class="spec value" id="val-find_matches"><a href="#val-find_matches" class="anchor"></a><code><span class="keyword">val</span> find_matches : <span><a href="../index.html#type-ro">ro</a> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><a href="argument-1-L/index.html#type-op">L.op</a> <a href="../Query/index.html#type-t">Query.t</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../../Id/index.html#type-t">Id.t</a> * <span><a href="../../Id/index.html#type-t">Id.t</a> <a href="../index.html#module-StringMap">StringMap</a>.t</span>)</span> Iter.t</span></code></dt><dd><p><code>find_matches graph query</code> returns an iterator over each match of the query <code>query</code> in the EGraph.</p></dd></dl><dl><dt class="spec value" id="val-apply_rules"><a href="#val-apply_rules" class="anchor"></a><code><span class="keyword">val</span> apply_rules : <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <a href="../index.html#type-rw">rw</a>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span>&#45;&gt;</span> <span><a href="Rule/index.html#type-t">Rule.t</a> list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>apply_rules graph rules</code> runs each of the rewrites in <code>rules</code> exactly once over the egraph <code>graph</code> and then returns.</p></dd></dl><dl><dt class="spec value" id="val-run_until_saturation"><a href="#val-run_until_saturation" class="anchor"></a><code><span class="keyword">val</span> run_until_saturation : <span>?&#8288;scheduler:<a href="../Scheduler/Backoff/index.html#type-t">Scheduler.Backoff.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;node_limit:<span>[ <span>`Bounded of int</span> <span>| `Unbounded</span> ]</span></span> <span>&#45;&gt;</span> <span>?&#8288;fuel:<span>[ <span>`Bounded of int</span> <span>| `Unbounded</span> ]</span></span> <span>&#45;&gt;</span> <span>?&#8288;until:<span>(<span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <a href="../index.html#type-rw">rw</a>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <a href="../index.html#type-rw">rw</a>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span>&#45;&gt;</span> <span><a href="Rule/index.html#type-t">Rule.t</a> list</span> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>run_until_saturation ?scheduler ?node_limit ?fuel ?until
         graph rules</code> repeatedly each one of the rewrites in <code>rules</code> according to the scheduler <code>scheduler</code> until no further changes occur (<i>i.e equality saturation</i>), or until it runs out of <code>fuel</code> (defaults to 30) or reaches a <code>node_limit</code> if supplied (defaults to 10_000) or some predicate <code>until</code> is satisfied.</p><p>It returns a boolean indicating whether it reached equality saturation or had to terminate early.</p></dd></dl><dl><dt class="spec module" id="module-BuildRunner"><a href="#module-BuildRunner" class="anchor"></a><code><span class="keyword">module</span> <a href="BuildRunner/index.html">BuildRunner</a> : <span class="keyword">functor</span> (<a href="BuildRunner/argument-1-S/index.html">S</a> : <a href="../index.html#module-type-SCHEDULER">SCHEDULER</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>'a <a href="BuildRunner/index.html#type-egraph">egraph</a></span> := <span><span>(<span><a href="../../Id/index.html#type-t">Id.t</a> <a href="argument-1-L/index.html#type-shape">L.shape</a></span>, <a href="argument-2-A/index.html#type-t">A.t</a>, <a href="argument-2-A/index.html#type-data">A.data</a>, <a href="../index.html#type-rw">rw</a>)</span> <a href="../index.html#type-egraph">egraph</a></span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="BuildRunner/index.html#type-rule">rule</a> := <a href="Rule/index.html#type-t">Rule.t</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The module <a href="BuildRunner/index.html"><code>BuildRunner</code></a> allows users to supply their own custom domain-specific scheduling strategies for equality saturation by supplying a corresponding Scheduling module satisfying <a href="../module-type-SCHEDULER/index.html"><code>SCHEDULER</code></a></p></dd></dl></div></body></html>